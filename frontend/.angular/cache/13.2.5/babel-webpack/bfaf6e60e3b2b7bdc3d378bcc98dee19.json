{"ast":null,"code":"import _asyncToGenerator from \"C:\\\\Users\\\\Usuario\\\\Documents\\\\ingenieriamultimedia\\\\TFG\\\\HangingOut\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";\nimport { Validators } from '@angular/forms';\nimport Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"src/app/services/actividades.service\";\nimport * as i3 from \"../../services/usuario.service\";\nimport * as i4 from \"src/app/services/provincias.service\";\nimport * as i5 from \"src/app/services/categorias.service\";\nimport * as i6 from \"@angular/router\";\nexport class EditarActividadComponent {\n  constructor(fb, actividadService, usuarioService, provinciaService, categoriasService, router, route) {\n    this.fb = fb;\n    this.actividadService = actividadService;\n    this.usuarioService = usuarioService;\n    this.provinciaService = provinciaService;\n    this.categoriasService = categoriasService;\n    this.router = router;\n    this.route = route;\n    this.registerForm = this.fb.group({\n      organizador: [''],\n      titulo: ['', Validators.required],\n      descripcion: ['', Validators.required],\n      requisitos: ['', Validators.required],\n      fecha: ['', [Validators.required]],\n      hora: ['', Validators.required],\n      direccion: ['', [Validators.required]],\n      poblacion: ['', Validators.required],\n      provincia: ['', Validators.required],\n      min_participantes: ['', Validators.required],\n      max_participantes: ['', Validators.required],\n      precio: ['', Validators.required],\n      categorias: [new Array([]), Validators.required],\n      participa: [''],\n      imagenes: [''],\n      fotos: ['']\n    });\n    this.listaCategorias = [];\n    this.listaFotos = [];\n    this.listaArchivos = [];\n    this.filechanged = false;\n    this.listaProvincias = [];\n    this.participa = false;\n    this.formSubmit = false;\n    this.waiting = false;\n    this.pathFotos = \"\";\n  }\n\n  ngOnInit() {\n    this.actividadId = this.route.snapshot.params['uid'];\n    this.cargarProvincias();\n    this.cargarCategorias();\n    this.cargarOrganizador();\n    this.cargarActividad();\n    this.pathFotos = \"../../../assets/imgs/actividades/\";\n  }\n\n  cargarActividad() {\n    this.waiting = true;\n    this.actividadService.cargarActividad(this.actividadId).subscribe(res => {\n      var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;\n\n      let actividad = res['existeActividad'];\n      console.log(actividad);\n      (_a = this.registerForm.get('titulo')) === null || _a === void 0 ? void 0 : _a.setValue(actividad.titulo);\n      (_b = this.registerForm.get('descripcion')) === null || _b === void 0 ? void 0 : _b.setValue(actividad.descripcion);\n      (_c = this.registerForm.get('requisitos')) === null || _c === void 0 ? void 0 : _c.setValue(actividad.requisitos);\n      (_d = this.registerForm.get('imagenes')) === null || _d === void 0 ? void 0 : _d.setValue(actividad.fotos);\n      (_e = this.registerForm.get('min_participantes')) === null || _e === void 0 ? void 0 : _e.setValue(actividad.min_participantes);\n      (_f = this.registerForm.get('max_participantes')) === null || _f === void 0 ? void 0 : _f.setValue(actividad.max_participantes);\n      (_g = this.registerForm.get('direccion')) === null || _g === void 0 ? void 0 : _g.setValue(actividad.direccion);\n      (_h = this.registerForm.get('poblacion')) === null || _h === void 0 ? void 0 : _h.setValue(actividad.poblacion);\n      (_j = this.registerForm.get('provincia')) === null || _j === void 0 ? void 0 : _j.setValue(actividad.provincia);\n      (_k = this.registerForm.get('pais')) === null || _k === void 0 ? void 0 : _k.setValue(actividad.pais);\n      let fecha = new Date(actividad.fecha);\n      (_l = this.registerForm.get('fecha')) === null || _l === void 0 ? void 0 : _l.setValue(this.convertirFecha(fecha));\n      (_m = this.registerForm.get('hora')) === null || _m === void 0 ? void 0 : _m.setValue(this.convertirHora(fecha));\n      (_o = this.registerForm.get('participa')) === null || _o === void 0 ? void 0 : _o.setValue(actividad.participa);\n\n      if (actividad.participa) {\n        this.participa = true;\n      }\n\n      (_p = this.registerForm.get('precio')) === null || _p === void 0 ? void 0 : _p.setValue(actividad.precio);\n\n      for (let i = 0; i < actividad.categorias.length; i++) {\n        for (let j = 0; j < this.listaCategorias.length; j++) {\n          if (actividad.categorias[i] === this.listaCategorias[j].uid) {\n            this.listaCategorias[j].marcado = true;\n          }\n        }\n      }\n\n      for (let i = 0; i < actividad.fotos.length; i++) {\n        let img = this.pathFotos + actividad.fotos[i];\n        this.listaFotos.push(img);\n      }\n\n      this.waiting = false;\n    }, err => {\n      console.log(err);\n      this.waiting = false;\n    });\n  }\n\n  actualizarActividad() {\n    var _a, _b, _c, _d;\n\n    this.formSubmit = true;\n    this.waiting = true;\n    console.log('quiero crear una actividad'); // console.log(this.registerForm.value);\n\n    if (!this.registerForm.valid) {\n      console.log('el formulario no es válido');\n      return;\n    }\n\n    if (this.filechanged) {\n      this.subirFotos(this.actividadId);\n    } else {\n      (_a = this.registerForm.get('fotos')) === null || _a === void 0 ? void 0 : _a.setValue(this.registerForm.controls['imagenes'].value);\n    }\n\n    let categorias = [];\n\n    for (let i = 0; i < this.listaCategorias.length; i++) {\n      if (this.listaCategorias[i].marcado) {\n        categorias.push(this.listaCategorias[i].uid);\n      }\n    }\n\n    (_b = this.registerForm.get('fecha')) === null || _b === void 0 ? void 0 : _b.setValue(this.convertirFechayHora());\n    (_c = this.registerForm.get('categorias')) === null || _c === void 0 ? void 0 : _c.setValue(categorias);\n    (_d = this.registerForm.get('organizador')) === null || _d === void 0 ? void 0 : _d.setValue(this.usuarioId);\n    this.actividadService.actualizarActividad(this.actividadId, this.registerForm.value).subscribe(res => {\n      console.log(res);\n    }, err => {\n      console.log(err);\n    });\n  }\n\n  cargarOrganizador() {\n    let email = localStorage.getItem('email');\n\n    if (!email) {\n      email = \"\";\n    }\n\n    this.usuarioService.cargarUsuario(\"\", email).subscribe(res => {\n      this.usuarioId = res['existeUsuario'].uid;\n    }, err => {\n      console.log(err);\n    });\n  }\n\n  convertirFechayHora() {\n    var _a, _b, _c;\n\n    let fecha = new Date((_a = this.registerForm.get('fecha')) === null || _a === void 0 ? void 0 : _a.value);\n    let nuevaFecha = new Date();\n    let sh = (_b = this.registerForm.get('hora')) === null || _b === void 0 ? void 0 : _b.value.split(':')[0];\n    let sm = (_c = this.registerForm.get('hora')) === null || _c === void 0 ? void 0 : _c.value.split(':')[1];\n    nuevaFecha.setFullYear(fecha.getFullYear());\n    nuevaFecha.setMonth(fecha.getMonth());\n    nuevaFecha.setDate(fecha.getDate());\n    nuevaFecha.setHours(sh);\n    nuevaFecha.setMinutes(sm);\n    return nuevaFecha;\n  }\n\n  cargarProvincias() {\n    this.provinciaService.cargarProvincias().subscribe(res => {\n      console.log(res);\n      this.listaProvincias = res['provincias'];\n    }, err => {\n      const msgerror = err.error.msg || 'No se pudo completar la acción, vuelva a intentarlo';\n      Swal.fire({\n        icon: 'error',\n        title: 'Oops...',\n        text: msgerror\n      });\n    });\n  }\n\n  cargarCategorias() {\n    this.categoriasService.cargarCategorias().subscribe(res => {\n      this.listaCategorias = res['categorias'];\n      console.log(this.listaCategorias);\n    }, err => {\n      const msgerror = err.error.msg || 'No se pudo completar la acción, vuelva a intentarlo';\n      Swal.fire({\n        icon: 'error',\n        title: 'Oops...',\n        text: msgerror\n      });\n    });\n  }\n\n  selectFiles(event) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.filechanged = true;\n      const filesToUpload = event.target.files;\n\n      _this.listaArchivos.push(filesToUpload[0]);\n\n      console.log(filesToUpload);\n      var reader = new FileReader(); // this.imagePath = event.target.files;\n\n      reader.readAsDataURL(filesToUpload[0]);\n\n      reader.onload = _event => {\n        _this.listaFotos.push(reader.result);\n      };\n    })();\n  }\n\n  subirFotos(idActividad) {\n    const formData = new FormData();\n    console.log(this.listaArchivos);\n\n    for (let i = 0; i < this.listaArchivos.length; i++) {\n      formData.append('fotos', this.listaArchivos[i]);\n    }\n\n    console.log(formData);\n    this.actividadService.subirFotos(idActividad, formData).subscribe(res => {\n      var _a, _b, _c;\n\n      console.log(res);\n      let fotos = (_a = this.registerForm.get('imagenes')) === null || _a === void 0 ? void 0 : _a.value;\n\n      if (!fotos) {\n        fotos = [];\n      }\n\n      for (let i = 0; i < res['listaFotos'].length; i++) {\n        if (fotos[0] == \"\") {\n          fotos[0] = res['listaFotos'][i];\n        } else {\n          fotos.push(res['listaFotos'][i]);\n        }\n      }\n\n      (_b = this.registerForm.get('imagenes')) === null || _b === void 0 ? void 0 : _b.setValue(fotos);\n      (_c = this.registerForm.get('fotos')) === null || _c === void 0 ? void 0 : _c.setValue(fotos);\n      this.actividadService.actualizarActividad(idActividad, this.registerForm.value).subscribe(res => {\n        console.log(res);\n        this.router.navigateByUrl('/actividades/organizadas');\n      }, err => {\n        console.log(err);\n      });\n    }, err => {\n      console.log(err);\n      const msgerror = err.error.msg || 'No se pudo completar la acción, vuelva a intentarlo';\n      Swal.fire({\n        icon: 'error',\n        title: 'Oops...',\n        text: msgerror\n      });\n    });\n  }\n\n  onCheckboxChange(e, uid) {\n    if (e.target.checked) {\n      for (let i = 0; i < this.listaCategorias.length; i++) {\n        if (this.listaCategorias[i].uid === uid) {\n          this.listaCategorias[i].marcado = true;\n        }\n      }\n    } else {\n      for (let i = 0; i < this.listaCategorias.length; i++) {\n        if (this.listaCategorias[i].uid === uid) {\n          this.listaCategorias[i].marcado = false;\n        }\n      }\n    }\n  }\n\n  borrarFotos() {\n    console.log(\"Quiero borrar fotos\");\n    this.listaFotos = [];\n    this.listaArchivos = [];\n  }\n\n  onCheckboxChange2(e) {\n    if (e.target.checked) {\n      this.participa = true;\n    } else {\n      this.participa = false;\n    }\n  }\n\n  convertirFecha(datecita) {\n    let year = datecita.getFullYear().toString();\n    let month = datecita.getMonth() + 1;\n    let dt = datecita.getDate();\n    let stringo = '',\n        sdia = '',\n        smes = '',\n        syear = '';\n\n    if (dt < 10) {\n      sdia = '0' + dt.toString();\n    } else {\n      sdia = dt.toString();\n    }\n\n    if (month < 10) {\n      smes = '0' + month.toString();\n    } else {\n      smes = month.toString();\n    }\n\n    syear = year.toString();\n    stringo = syear + '-' + smes + '-' + sdia;\n    return stringo;\n  }\n\n  convertirHora(fecha) {\n    let hora = fecha.getHours();\n    let minutos = fecha.getMinutes();\n    let shora = \"\",\n        sminut = \"\";\n\n    if (hora < 10) {\n      shora = \"0\" + hora.toString();\n    } else {\n      shora = hora.toString();\n    }\n\n    if (minutos < 10) {\n      sminut = \"0\" + minutos.toString();\n    } else {\n      sminut = minutos.toString();\n    }\n\n    let resultado = \"\";\n    resultado = shora + \":\" + sminut;\n    return resultado;\n  }\n\n  get arrayCategorias() {\n    return this.registerForm.controls[\"categorias\"];\n  }\n\n}\n\nEditarActividadComponent.ɵfac = function EditarActividadComponent_Factory(t) {\n  return new (t || EditarActividadComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ActividadesService), i0.ɵɵdirectiveInject(i3.UsuarioService), i0.ɵɵdirectiveInject(i4.ProvinciaService), i0.ɵɵdirectiveInject(i5.CategoriasService), i0.ɵɵdirectiveInject(i6.Router), i0.ɵɵdirectiveInject(i6.ActivatedRoute));\n};\n\nEditarActividadComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: EditarActividadComponent,\n  selectors: [[\"app-editar-actividad\"]],\n  decls: 2,\n  vars: 0,\n  template: function EditarActividadComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"p\");\n      i0.ɵɵtext(1, \"editar-actividad works!\");\n      i0.ɵɵelementEnd();\n    }\n  },\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJlZGl0YXItYWN0aXZpZGFkLmNvbXBvbmVudC5jc3MifQ== */\"]\n});","map":{"version":3,"sources":["C:/Users/Usuario/Documents/ingenieriamultimedia/TFG/HangingOut/frontend/src/app/cliente/editar-actividad/editar-actividad.component.ts"],"names":["Validators","Swal","i0","i1","i2","i3","i4","i5","i6","EditarActividadComponent","constructor","fb","actividadService","usuarioService","provinciaService","categoriasService","router","route","registerForm","group","organizador","titulo","required","descripcion","requisitos","fecha","hora","direccion","poblacion","provincia","min_participantes","max_participantes","precio","categorias","Array","participa","imagenes","fotos","listaCategorias","listaFotos","listaArchivos","filechanged","listaProvincias","formSubmit","waiting","pathFotos","ngOnInit","actividadId","snapshot","params","cargarProvincias","cargarCategorias","cargarOrganizador","cargarActividad","subscribe","res","_a","_b","_c","_d","_e","_f","_g","_h","_j","_k","_l","_m","_o","_p","actividad","console","log","get","setValue","pais","Date","convertirFecha","convertirHora","i","length","j","uid","marcado","img","push","err","actualizarActividad","valid","subirFotos","controls","value","convertirFechayHora","usuarioId","email","localStorage","getItem","cargarUsuario","nuevaFecha","sh","split","sm","setFullYear","getFullYear","setMonth","getMonth","setDate","getDate","setHours","setMinutes","msgerror","error","msg","fire","icon","title","text","selectFiles","event","filesToUpload","target","files","reader","FileReader","readAsDataURL","onload","_event","result","idActividad","formData","FormData","append","navigateByUrl","onCheckboxChange","e","checked","borrarFotos","onCheckboxChange2","datecita","year","toString","month","dt","stringo","sdia","smes","syear","getHours","minutos","getMinutes","shora","sminut","resultado","arrayCategorias","ɵfac","EditarActividadComponent_Factory","t","ɵɵdirectiveInject","FormBuilder","ActividadesService","UsuarioService","ProvinciaService","CategoriasService","Router","ActivatedRoute","ɵcmp","ɵɵdefineComponent","type","selectors","decls","vars","template","EditarActividadComponent_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","styles"],"mappings":"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","sourcesContent":["import { Validators } from '@angular/forms';\r\nimport Swal from 'sweetalert2';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/forms\";\r\nimport * as i2 from \"src/app/services/actividades.service\";\r\nimport * as i3 from \"../../services/usuario.service\";\r\nimport * as i4 from \"src/app/services/provincias.service\";\r\nimport * as i5 from \"src/app/services/categorias.service\";\r\nimport * as i6 from \"@angular/router\";\r\nexport class EditarActividadComponent {\r\n    constructor(fb, actividadService, usuarioService, provinciaService, categoriasService, router, route) {\r\n        this.fb = fb;\r\n        this.actividadService = actividadService;\r\n        this.usuarioService = usuarioService;\r\n        this.provinciaService = provinciaService;\r\n        this.categoriasService = categoriasService;\r\n        this.router = router;\r\n        this.route = route;\r\n        this.registerForm = this.fb.group({\r\n            organizador: [''],\r\n            titulo: ['', Validators.required],\r\n            descripcion: ['', Validators.required],\r\n            requisitos: ['', Validators.required],\r\n            fecha: ['', [Validators.required]],\r\n            hora: ['', Validators.required],\r\n            direccion: ['', [Validators.required]],\r\n            poblacion: ['', Validators.required],\r\n            provincia: ['', Validators.required],\r\n            min_participantes: ['', Validators.required],\r\n            max_participantes: ['', Validators.required],\r\n            precio: ['', Validators.required],\r\n            categorias: [new Array([]), Validators.required],\r\n            participa: [''],\r\n            imagenes: [''],\r\n            fotos: ['']\r\n        });\r\n        this.listaCategorias = [];\r\n        this.listaFotos = [];\r\n        this.listaArchivos = [];\r\n        this.filechanged = false;\r\n        this.listaProvincias = [];\r\n        this.participa = false;\r\n        this.formSubmit = false;\r\n        this.waiting = false;\r\n        this.pathFotos = \"\";\r\n    }\r\n    ngOnInit() {\r\n        this.actividadId = this.route.snapshot.params['uid'];\r\n        this.cargarProvincias();\r\n        this.cargarCategorias();\r\n        this.cargarOrganizador();\r\n        this.cargarActividad();\r\n        this.pathFotos = \"../../../assets/imgs/actividades/\";\r\n    }\r\n    cargarActividad() {\r\n        this.waiting = true;\r\n        this.actividadService.cargarActividad(this.actividadId)\r\n            .subscribe((res) => {\r\n            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;\r\n            let actividad = res['existeActividad'];\r\n            console.log(actividad);\r\n            (_a = this.registerForm.get('titulo')) === null || _a === void 0 ? void 0 : _a.setValue(actividad.titulo);\r\n            (_b = this.registerForm.get('descripcion')) === null || _b === void 0 ? void 0 : _b.setValue(actividad.descripcion);\r\n            (_c = this.registerForm.get('requisitos')) === null || _c === void 0 ? void 0 : _c.setValue(actividad.requisitos);\r\n            (_d = this.registerForm.get('imagenes')) === null || _d === void 0 ? void 0 : _d.setValue(actividad.fotos);\r\n            (_e = this.registerForm.get('min_participantes')) === null || _e === void 0 ? void 0 : _e.setValue(actividad.min_participantes);\r\n            (_f = this.registerForm.get('max_participantes')) === null || _f === void 0 ? void 0 : _f.setValue(actividad.max_participantes);\r\n            (_g = this.registerForm.get('direccion')) === null || _g === void 0 ? void 0 : _g.setValue(actividad.direccion);\r\n            (_h = this.registerForm.get('poblacion')) === null || _h === void 0 ? void 0 : _h.setValue(actividad.poblacion);\r\n            (_j = this.registerForm.get('provincia')) === null || _j === void 0 ? void 0 : _j.setValue(actividad.provincia);\r\n            (_k = this.registerForm.get('pais')) === null || _k === void 0 ? void 0 : _k.setValue(actividad.pais);\r\n            let fecha = new Date(actividad.fecha);\r\n            (_l = this.registerForm.get('fecha')) === null || _l === void 0 ? void 0 : _l.setValue(this.convertirFecha(fecha));\r\n            (_m = this.registerForm.get('hora')) === null || _m === void 0 ? void 0 : _m.setValue(this.convertirHora(fecha));\r\n            (_o = this.registerForm.get('participa')) === null || _o === void 0 ? void 0 : _o.setValue(actividad.participa);\r\n            if (actividad.participa) {\r\n                this.participa = true;\r\n            }\r\n            (_p = this.registerForm.get('precio')) === null || _p === void 0 ? void 0 : _p.setValue(actividad.precio);\r\n            for (let i = 0; i < actividad.categorias.length; i++) {\r\n                for (let j = 0; j < this.listaCategorias.length; j++) {\r\n                    if (actividad.categorias[i] === this.listaCategorias[j].uid) {\r\n                        this.listaCategorias[j].marcado = true;\r\n                    }\r\n                }\r\n            }\r\n            for (let i = 0; i < actividad.fotos.length; i++) {\r\n                let img = this.pathFotos + actividad.fotos[i];\r\n                this.listaFotos.push(img);\r\n            }\r\n            this.waiting = false;\r\n        }, (err) => {\r\n            console.log(err);\r\n            this.waiting = false;\r\n        });\r\n    }\r\n    actualizarActividad() {\r\n        var _a, _b, _c, _d;\r\n        this.formSubmit = true;\r\n        this.waiting = true;\r\n        console.log('quiero crear una actividad');\r\n        // console.log(this.registerForm.value);\r\n        if (!this.registerForm.valid) {\r\n            console.log('el formulario no es válido');\r\n            return;\r\n        }\r\n        if (this.filechanged) {\r\n            this.subirFotos(this.actividadId);\r\n        }\r\n        else {\r\n            (_a = this.registerForm.get('fotos')) === null || _a === void 0 ? void 0 : _a.setValue(this.registerForm.controls['imagenes'].value);\r\n        }\r\n        let categorias = [];\r\n        for (let i = 0; i < this.listaCategorias.length; i++) {\r\n            if (this.listaCategorias[i].marcado) {\r\n                categorias.push(this.listaCategorias[i].uid);\r\n            }\r\n        }\r\n        (_b = this.registerForm.get('fecha')) === null || _b === void 0 ? void 0 : _b.setValue(this.convertirFechayHora());\r\n        (_c = this.registerForm.get('categorias')) === null || _c === void 0 ? void 0 : _c.setValue(categorias);\r\n        (_d = this.registerForm.get('organizador')) === null || _d === void 0 ? void 0 : _d.setValue(this.usuarioId);\r\n        this.actividadService.actualizarActividad(this.actividadId, this.registerForm.value)\r\n            .subscribe((res) => {\r\n            console.log(res);\r\n        }, (err) => {\r\n            console.log(err);\r\n        });\r\n    }\r\n    cargarOrganizador() {\r\n        let email = localStorage.getItem('email');\r\n        if (!email) {\r\n            email = \"\";\r\n        }\r\n        this.usuarioService.cargarUsuario(\"\", email)\r\n            .subscribe((res) => {\r\n            this.usuarioId = res['existeUsuario'].uid;\r\n        }, (err) => {\r\n            console.log(err);\r\n        });\r\n    }\r\n    convertirFechayHora() {\r\n        var _a, _b, _c;\r\n        let fecha = new Date((_a = this.registerForm.get('fecha')) === null || _a === void 0 ? void 0 : _a.value);\r\n        let nuevaFecha = new Date();\r\n        let sh = (_b = this.registerForm.get('hora')) === null || _b === void 0 ? void 0 : _b.value.split(':')[0];\r\n        let sm = (_c = this.registerForm.get('hora')) === null || _c === void 0 ? void 0 : _c.value.split(':')[1];\r\n        nuevaFecha.setFullYear(fecha.getFullYear());\r\n        nuevaFecha.setMonth(fecha.getMonth());\r\n        nuevaFecha.setDate(fecha.getDate());\r\n        nuevaFecha.setHours(sh);\r\n        nuevaFecha.setMinutes(sm);\r\n        return nuevaFecha;\r\n    }\r\n    cargarProvincias() {\r\n        this.provinciaService.cargarProvincias()\r\n            .subscribe((res) => {\r\n            console.log(res);\r\n            this.listaProvincias = res['provincias'];\r\n        }, (err) => {\r\n            const msgerror = err.error.msg || 'No se pudo completar la acción, vuelva a intentarlo';\r\n            Swal.fire({ icon: 'error', title: 'Oops...', text: msgerror });\r\n        });\r\n    }\r\n    cargarCategorias() {\r\n        this.categoriasService.cargarCategorias()\r\n            .subscribe((res) => {\r\n            this.listaCategorias = res['categorias'];\r\n            console.log(this.listaCategorias);\r\n        }, (err) => {\r\n            const msgerror = err.error.msg || 'No se pudo completar la acción, vuelva a intentarlo';\r\n            Swal.fire({ icon: 'error', title: 'Oops...', text: msgerror });\r\n        });\r\n    }\r\n    async selectFiles(event) {\r\n        this.filechanged = true;\r\n        const filesToUpload = event.target.files;\r\n        this.listaArchivos.push(filesToUpload[0]);\r\n        console.log(filesToUpload);\r\n        var reader = new FileReader();\r\n        // this.imagePath = event.target.files;\r\n        reader.readAsDataURL(filesToUpload[0]);\r\n        reader.onload = (_event) => {\r\n            this.listaFotos.push(reader.result);\r\n        };\r\n    }\r\n    subirFotos(idActividad) {\r\n        const formData = new FormData();\r\n        console.log(this.listaArchivos);\r\n        for (let i = 0; i < this.listaArchivos.length; i++) {\r\n            formData.append('fotos', this.listaArchivos[i]);\r\n        }\r\n        console.log(formData);\r\n        this.actividadService.subirFotos(idActividad, formData)\r\n            .subscribe((res) => {\r\n            var _a, _b, _c;\r\n            console.log(res);\r\n            let fotos = (_a = this.registerForm.get('imagenes')) === null || _a === void 0 ? void 0 : _a.value;\r\n            if (!fotos) {\r\n                fotos = [];\r\n            }\r\n            for (let i = 0; i < res['listaFotos'].length; i++) {\r\n                if (fotos[0] == \"\") {\r\n                    fotos[0] = res['listaFotos'][i];\r\n                }\r\n                else {\r\n                    fotos.push(res['listaFotos'][i]);\r\n                }\r\n            }\r\n            (_b = this.registerForm.get('imagenes')) === null || _b === void 0 ? void 0 : _b.setValue(fotos);\r\n            (_c = this.registerForm.get('fotos')) === null || _c === void 0 ? void 0 : _c.setValue(fotos);\r\n            this.actividadService.actualizarActividad(idActividad, this.registerForm.value)\r\n                .subscribe((res) => {\r\n                console.log(res);\r\n                this.router.navigateByUrl('/actividades/organizadas');\r\n            }, (err) => {\r\n                console.log(err);\r\n            });\r\n        }, (err) => {\r\n            console.log(err);\r\n            const msgerror = err.error.msg || 'No se pudo completar la acción, vuelva a intentarlo';\r\n            Swal.fire({ icon: 'error', title: 'Oops...', text: msgerror });\r\n        });\r\n    }\r\n    onCheckboxChange(e, uid) {\r\n        if (e.target.checked) {\r\n            for (let i = 0; i < this.listaCategorias.length; i++) {\r\n                if (this.listaCategorias[i].uid === uid) {\r\n                    this.listaCategorias[i].marcado = true;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            for (let i = 0; i < this.listaCategorias.length; i++) {\r\n                if (this.listaCategorias[i].uid === uid) {\r\n                    this.listaCategorias[i].marcado = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    borrarFotos() {\r\n        console.log(\"Quiero borrar fotos\");\r\n        this.listaFotos = [];\r\n        this.listaArchivos = [];\r\n    }\r\n    onCheckboxChange2(e) {\r\n        if (e.target.checked) {\r\n            this.participa = true;\r\n        }\r\n        else {\r\n            this.participa = false;\r\n        }\r\n    }\r\n    convertirFecha(datecita) {\r\n        let year = datecita.getFullYear().toString();\r\n        let month = datecita.getMonth() + 1;\r\n        let dt = datecita.getDate();\r\n        let stringo = '', sdia = '', smes = '', syear = '';\r\n        if (dt < 10) {\r\n            sdia = '0' + dt.toString();\r\n        }\r\n        else {\r\n            sdia = dt.toString();\r\n        }\r\n        if (month < 10) {\r\n            smes = '0' + month.toString();\r\n        }\r\n        else {\r\n            smes = month.toString();\r\n        }\r\n        syear = year.toString();\r\n        stringo = syear + '-' + smes + '-' + sdia;\r\n        return stringo;\r\n    }\r\n    convertirHora(fecha) {\r\n        let hora = fecha.getHours();\r\n        let minutos = fecha.getMinutes();\r\n        let shora = \"\", sminut = \"\";\r\n        if (hora < 10) {\r\n            shora = \"0\" + hora.toString();\r\n        }\r\n        else {\r\n            shora = hora.toString();\r\n        }\r\n        if (minutos < 10) {\r\n            sminut = \"0\" + minutos.toString();\r\n        }\r\n        else {\r\n            sminut = minutos.toString();\r\n        }\r\n        let resultado = \"\";\r\n        resultado = shora + \":\" + sminut;\r\n        return resultado;\r\n    }\r\n    get arrayCategorias() {\r\n        return this.registerForm.controls[\"categorias\"];\r\n    }\r\n}\r\nEditarActividadComponent.ɵfac = function EditarActividadComponent_Factory(t) { return new (t || EditarActividadComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ActividadesService), i0.ɵɵdirectiveInject(i3.UsuarioService), i0.ɵɵdirectiveInject(i4.ProvinciaService), i0.ɵɵdirectiveInject(i5.CategoriasService), i0.ɵɵdirectiveInject(i6.Router), i0.ɵɵdirectiveInject(i6.ActivatedRoute)); };\r\nEditarActividadComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: EditarActividadComponent, selectors: [[\"app-editar-actividad\"]], decls: 2, vars: 0, template: function EditarActividadComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵelementStart(0, \"p\");\r\n        i0.ɵɵtext(1, \"editar-actividad works!\");\r\n        i0.ɵɵelementEnd();\r\n    } }, styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJlZGl0YXItYWN0aXZpZGFkLmNvbXBvbmVudC5jc3MifQ== */\"] });\r\n"]},"metadata":{},"sourceType":"module"}