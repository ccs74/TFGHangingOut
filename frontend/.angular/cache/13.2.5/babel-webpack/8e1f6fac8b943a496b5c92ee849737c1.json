{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/usuario.service\";\nimport * as i2 from \"src/app/services/categorias.service\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\n\nfunction ElegirCategoriasComponent_button_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function ElegirCategoriasComponent_button_12_Template_button_click_0_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r3);\n      const categoria_r1 = restoredCtx.$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.onCheckboxChange($event, categoria_r1.uid);\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const categoria_r1 = ctx.$implicit;\n    i0.ɵɵclassMap(categoria_r1.clase);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(categoria_r1.nombre);\n  }\n}\n\nexport let ElegirCategoriasComponent = /*#__PURE__*/(() => {\n  class ElegirCategoriasComponent {\n    constructor(usuarioService, categoriasService, fb, router) {\n      this.usuarioService = usuarioService;\n      this.categoriasService = categoriasService;\n      this.fb = fb;\n      this.router = router;\n      this.listaCategorias = [];\n      this.usuarioForm = this.fb.group({\n        nombre: ['', Validators.required],\n        apellidos: ['', Validators.required],\n        email: ['', [Validators.required, Validators.email]],\n        fecha_nacimiento: ['', Validators.required],\n        pais: ['', Validators.required],\n        poblacion: ['', Validators.required],\n        provincia: ['', Validators.required],\n        descripcion: ['', Validators.required],\n        foto: [''],\n        intereses: ['', Validators.required],\n        firstTime: ['']\n      });\n      this.waiting = false;\n    }\n\n    ngOnInit() {\n      this.cargarUsuario();\n      this.cargarCategorias();\n    }\n\n    cargarUsuario() {\n      let usuario = localStorage.getItem('email');\n\n      if (!usuario) {\n        return;\n      }\n\n      this.usuarioService.cargarUsuario(\"\", usuario).subscribe(res => {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n\n        console.log(res);\n        this.idUsuario = res['existeUsuario'].uid;\n        (_a = this.usuarioForm.get('nombre')) === null || _a === void 0 ? void 0 : _a.setValue(res['existeUsuario'].nombre);\n        (_b = this.usuarioForm.get('apellidos')) === null || _b === void 0 ? void 0 : _b.setValue(res['existeUsuario'].apellidos);\n        (_c = this.usuarioForm.get('email')) === null || _c === void 0 ? void 0 : _c.setValue(res['existeUsuario'].email);\n        (_d = this.usuarioForm.get('fecha_nacimiento')) === null || _d === void 0 ? void 0 : _d.setValue(res['existeUsuario'].fecha_nacimiento);\n        (_e = this.usuarioForm.get('pais')) === null || _e === void 0 ? void 0 : _e.setValue(res['existeUsuario'].pais);\n        (_f = this.usuarioForm.get('poblacion')) === null || _f === void 0 ? void 0 : _f.setValue(res['existeUsuario'].poblacion);\n        (_g = this.usuarioForm.get('provincia')) === null || _g === void 0 ? void 0 : _g.setValue(res['existeUsuario'].provincia);\n        (_h = this.usuarioForm.get('descripcion')) === null || _h === void 0 ? void 0 : _h.setValue(res['existeUsuario'].descripcion);\n        (_j = this.usuarioForm.get('foto')) === null || _j === void 0 ? void 0 : _j.setValue(res['existeUsuario'].foto);\n      }, err => {\n        Swal.fire({\n          icon: 'error',\n          title: 'Oops...',\n          text: 'No se pudo completar la acción, vuelva a intentarlo'\n        });\n      });\n    }\n\n    cargarCategorias() {\n      this.categoriasService.cargarCategorias().subscribe(res => {\n        this.listaCategorias = res['categorias'];\n\n        for (let i = 0; i < this.listaCategorias.length; i++) {\n          this.listaCategorias[i].marcado = false;\n          this.listaCategorias[i].clase = \"categoria\";\n        }\n\n        console.log(this.listaCategorias);\n      }, err => {\n        const msgerror = err.error.msg || 'No se pudo completar la acción, vuelva a intentarlo';\n        Swal.fire({\n          icon: 'error',\n          title: 'Oops...',\n          text: msgerror\n        });\n        console.log(err);\n      });\n    }\n\n    actualizarUsuario() {\n      var _a, _b;\n\n      this.waiting = true;\n      let intereses = [];\n\n      for (let i = 0; i < this.listaCategorias.length; i++) {\n        if (this.listaCategorias[i].marcado) {\n          intereses.push(this.listaCategorias[i].uid);\n        }\n      }\n\n      if (intereses.length == 0) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Debes seleccionar las categorías que te interesen',\n          showConfirmButton: false,\n          timer: 1500\n        });\n      } else {\n        (_a = this.usuarioForm.get('intereses')) === null || _a === void 0 ? void 0 : _a.setValue(intereses);\n        (_b = this.usuarioForm.get('firstTime')) === null || _b === void 0 ? void 0 : _b.setValue(false);\n        this.usuarioService.actualizarUsuario(this.idUsuario, this.usuarioForm.value).subscribe(res => {\n          console.log(res);\n          this.router.navigateByUrl('/editar-perfil');\n        }, err => {\n          const msgerror = err.error.msg || 'No se pudo completar la acción, vuelva a intentarlo';\n          Swal.fire({\n            icon: 'error',\n            title: 'Oops...',\n            text: msgerror\n          });\n          console.log(err);\n        });\n      }\n    }\n\n    onCheckboxChange(e, uid) {\n      for (let i = 0; i < this.listaCategorias.length; i++) {\n        if (this.listaCategorias[i].uid === uid) {\n          if (!this.listaCategorias[i].marcado) {\n            this.listaCategorias[i].marcado = true;\n            this.listaCategorias[i].clase = \"categoria-selected\";\n          } else {\n            this.listaCategorias[i].marcado = false;\n            this.listaCategorias[i].clase = \"categoria\";\n          }\n        }\n      }\n\n      console.log(this.listaCategorias);\n    }\n\n  }\n\n  ElegirCategoriasComponent.ɵfac = function ElegirCategoriasComponent_Factory(t) {\n    return new (t || ElegirCategoriasComponent)(i0.ɵɵdirectiveInject(i1.UsuarioService), i0.ɵɵdirectiveInject(i2.CategoriasService), i0.ɵɵdirectiveInject(i3.FormBuilder), i0.ɵɵdirectiveInject(i4.Router));\n  };\n\n  ElegirCategoriasComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ElegirCategoriasComponent,\n    selectors: [[\"app-elegir-categorias\"]],\n    decls: 15,\n    vars: 1,\n    consts: [[\"id\", \"admin-back\"], [1, \"admin-header\"], [1, \"d-flex\", \"justify-content-between\"], [1, \"d-flex\"], [\"src\", \"../../../assets/imgs/Logo.png\", 1, \"logo\"], [\"routerLink\", \"/editar-perfil\", 1, \"fa-solid\", \"fa-user\", \"fa-3x\"], [1, \"seleccionCategorias\"], [1, \"mb-3\"], [\"type\", \"button\", 3, \"class\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", \"type\", \"submit\", 1, \"nextButton\", 3, \"click\"], [\"type\", \"button\", 3, \"click\"]],\n    template: function ElegirCategoriasComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"section\", 0)(1, \"header\", 1)(2, \"div\", 2)(3, \"div\", 3);\n        i0.ɵɵelement(4, \"img\", 4);\n        i0.ɵɵelementStart(5, \"h1\");\n        i0.ɵɵtext(6, \"Inicio\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(7, \"i\", 5);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(8, \"div\", 6)(9, \"h1\", 7);\n        i0.ɵɵtext(10, \"Selecciona las categor\\u00EDas que te gusten\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"div\");\n        i0.ɵɵtemplate(12, ElegirCategoriasComponent_button_12_Template, 2, 4, \"button\", 8);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(13, \"button\", 9);\n        i0.ɵɵlistener(\"click\", function ElegirCategoriasComponent_Template_button_click_13_listener() {\n          return ctx.actualizarUsuario();\n        });\n        i0.ɵɵtext(14, \"Siguiente\");\n        i0.ɵɵelementEnd()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngForOf\", ctx.listaCategorias);\n      }\n    },\n    directives: [i4.RouterLink, i5.NgForOf],\n    styles: [\"\"]\n  });\n  return ElegirCategoriasComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}